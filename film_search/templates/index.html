{% extends "base.html" %}
{% block content %}

  <h1>OMdb Search</h1>
    <form class="form-inline" id="search-form">
      <div class="form-group">
        <label for="search">Movie Title</label>
        <input type="text" class="form-control" id="search" placeholder="Movie title">
      </div>
      <button type="submit" class="btn btn-default" id="submit-button">Search</button>
    </form>
    <br />
    <div id="result"></div>
    <script>

        function display_results(results) {
          if (results.Response === 'True') {
            var table = '<table class="table table-bordered"><thead><th>Title</th><th>Released</th><th>Poster</th></thead><tbody>';
            table += generate_table(results.Search) + '</tbody>' 

            $('#result').html(table);
          }
          else {
            $('#result').text("No results match your query");
          }
        }

        function result_to_row(result) {
          var response = '<tr><td>'+result.Title+'</td><td>'+result.Year+'</td>'
          if (result.Poster === 'N/A') {
            response += '<td>N/A</td>';
          }
          else {
            response += '<td><a href="'+result.Poster+'">[link]</a></td>';
          }
          return response+'</tr>'
        }

        function generate_table(list) {
            var text = '';
            for (i=0; i<list.length; i++) {
              text += result_to_row(list[i]) + "\n";
            }
            return text
        }


        function make_request(string) {
          alert(string);
          var request = $.ajax({
            url:'http://www.omdbapi.com/?',
            type:"GET",
            data:{s:string,plot:"short",r:"json"}
            });
          request.done(function (msg) {display_results(msg);})
          request.fail(function (something, msg) {$('#result').text("Request failed: "+msg)})
        }

        
        $("#search-form").submit(function (){make_request($('#search').val()); return false;});
    </script> 
    
{% endblock %}

